// Assignment 11: PC-to-PC serial communication using UART (PIC18F example)
// Transmit a text string over UART. Connect TX/RX to MAX232 / USB-UART as appropriate.

#include <p18f4550.h>
#include <stdio.h>

#define _XTAL_FREQ 8000000

void UART_Init(void) {
    TRISCbits.TRISC6 = 0; // TX
    TRISCbits.TRISC7 = 1; // RX
    TXSTA = 0b00100100; // BRGH=1, TX enable
    RCSTA = 0b10010000; // SPEN=1, CREN=1
    SPBRG = 51; // for 9600 @ 8MHz (approx)
}

void UART_SendChar(char c){
    while(!PIR1bits.TXIF);
    TXREG = c;
}

void UART_SendString(const char *s){
    while(*s) UART_SendChar(*s++);
}

int main(void){
    UART_Init();
    UART_SendString("Hello from PIC\r\n");
    while(1);
    return 0;
}
