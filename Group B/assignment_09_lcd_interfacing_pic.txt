// Assignment 9: LCD interfacing with PIC18Fxxx (8-bit mode)
// Example adapted from uploaded file (use correct pins as per board)

#include <p18f4550.h>

#define LCD_EN LATAbits.LA1
#define LCD_RS LATAbits.LA0
#define LCDPORT LATB

void lcd_delay(unsigned int time) {
    unsigned int i , j ;
    for(i = 0; i < time; i++) for(j=0;j<100;j++);
}

void SendInstruction(unsigned char command) {
    LCD_RS = 0;
    LCDPORT = command;
    LCD_EN = 1;
    lcd_delay(10);
    LCD_EN = 0;
    lcd_delay(10);
}

void SendData(unsigned char lcddata) {
    LCD_RS = 1;
    LCDPORT = lcddata;
    LCD_EN = 1;
    lcd_delay(10);
    LCD_EN = 0;
    lcd_delay(10);
}

void InitLCD(void) {
    ADCON1 = 0x0F; // digital ports
    TRISB = 0x00;
    TRISAbits.RA0 = 0;
    TRISAbits.RA1 = 0;
    SendInstruction(0x38);
    SendInstruction(0x06);
    SendInstruction(0x0C);
    SendInstruction(0x01);
    SendInstruction(0x80);
}

int main(void){
    InitLCD();
    unsigned char *s1 = "Hello PIC";
    unsigned char *s2 = "LCD Demo";
    while(*s1) { SendData(*s1++); }
    SendInstruction(0xC0);
    while(*s2) { SendData(*s2++); }
    while(1);
    return 0;
}
